'use client';

import { Check, ChevronsUpDown, GalleryVerticalEnd } from 'lucide-react';
import * as React from 'react';

import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger
} from '@/components/ui/dropdown-menu';
import {
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem
} from '@/components/ui/sidebar';

interface Tenant {
  id: string;
  name: string;
}

export function OrgSwitcher({
  tenants,
  defaultTenant,
  onTenantSwitch
}: {
  tenants: Tenant[];
  defaultTenant: Tenant;
  onTenantSwitch?: (tenantId: string) => void;
}) {
  const [selectedTenant, setSelectedTenant] = React.useState<
    Tenant | undefined
  >(defaultTenant || (tenants.length > 0 ? tenants[0] : undefined));

  const handleTenantSwitch = (tenant: Tenant) => {
    setSelectedTenant(tenant);
    if (onTenantSwitch) {
      onTenantSwitch(tenant.id);
    }
  };

  if (!selectedTenant) {
    return null;
  }
  return (
    <SidebarMenu>
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <SidebarMenuButton
              size='lg'
              className='data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground'
            >
              <div className='bg-primary text-sidebar-primary-foreground flex aspect-square size-8 items-center justify-center rounded-lg'>
                <svg
                  xmlns='http://www.w3.org/2000/svg'
                  width='40'
                  height='33'
                  viewBox='0 0 40 33'
                  fill='none'
                >
                  <path
                    d='M12.6402 0.0935173C11.4864 0.303268 10.6904 0.759783 9.62305 1.83321L9.06775 2.3946L8.66671 2.43778C7.01933 2.62286 5.56323 3.54823 4.79198 4.88692C4.36626 5.62722 4.10712 6.52174 4.10095 7.21885C4.10095 7.63835 4.02074 7.76791 3.59502 8.0085C2.51528 8.62541 1.50958 9.88391 1.04066 11.2041C0.442175 12.8759 0.565574 14.6095 1.38618 16.0654L1.58978 16.417L1.3615 16.9476C0.93577 17.9161 0.867901 18.2801 0.867901 19.4954C0.874071 20.4886 0.886411 20.6182 1.04066 21.1241C1.47873 22.5615 2.54613 24.0174 3.6814 24.7207C4.31073 25.1155 4.34775 25.1648 4.34775 25.6522C4.34775 26.2197 4.49583 27.0217 4.68093 27.5091C5.53855 29.6806 7.69186 31.3648 9.91304 31.5931C10.4066 31.6424 10.6102 31.6979 11.0545 31.9015C11.8257 32.2593 12.1651 32.3333 12.9857 32.3333C15.139 32.3395 16.7247 31.1674 17.2306 29.1933C17.3293 28.8108 17.3355 27.9163 17.3355 15.9482C17.3355 3.48037 17.3293 3.10405 17.2182 2.68455C17.0517 2.09231 16.9221 1.80236 16.6013 1.37053C15.8115 0.2971 14.2567 -0.202599 12.6402 0.0935173ZM9.90687 6.82403C9.99325 6.86721 10.1722 7.0893 10.3079 7.32373C10.4437 7.56433 10.7707 7.97149 11.073 8.27377C11.6591 8.86601 12.1836 9.17447 12.8808 9.35337C13.3744 9.47675 13.578 9.61864 13.6582 9.89625C13.7384 10.1924 13.6767 10.4021 13.4669 10.581C13.2386 10.7784 12.9055 10.7846 12.3317 10.6057C11.184 10.2541 10.3079 9.60013 9.4688 8.48352C8.94436 7.78024 8.91351 7.71855 8.91351 7.37308C8.91351 7.01527 8.99372 6.86104 9.24051 6.75617C9.44412 6.6698 9.63539 6.68831 9.90687 6.82403ZM7.42655 13.2954C8.25332 13.6964 8.7716 14.3689 9.1603 15.5472C9.4071 16.2998 9.61688 16.6761 9.9624 16.9784C10.4066 17.3732 11.2149 17.7372 11.7825 17.8051C12.5044 17.8853 12.8006 18.1135 12.8006 18.5947C12.8006 18.8476 12.5723 19.1561 12.3317 19.2116C12.1404 19.261 11.2643 19.1068 10.7028 18.9278C9.30838 18.4837 8.29034 17.4226 7.93865 16.0284C7.72271 15.1832 7.35868 14.7267 6.65531 14.3997C6.14937 14.1715 6.01363 14.0172 6.01363 13.6779C6.01363 13.499 6.05682 13.3941 6.19256 13.2584C6.45787 12.9993 6.82807 13.0117 7.42655 13.2954ZM11.9615 22.7959C12.1836 22.9008 12.3687 23.1722 12.3687 23.4005C12.3687 23.6657 12.091 23.9187 11.7023 24.0297C10.0611 24.4862 9.56752 24.8811 9.19732 26.0162C9.06158 26.4233 8.86415 26.5899 8.51246 26.5899C8.29034 26.5899 8.2163 26.5591 8.08673 26.4048C7.85845 26.1272 7.8276 25.8619 7.98184 25.3684C8.13609 24.8625 8.56799 24.2148 9.07393 23.7521C9.48731 23.3758 10.2154 23.0056 10.9002 22.8267C11.4555 22.6848 11.7085 22.6787 11.9615 22.7959Z'
                    fill='white'
                  />
                  <path
                    d='M23.3512 3.74134C22.7034 3.85856 22.2406 4.41378 22.2406 5.06771C22.2406 5.3885 22.3825 5.69696 22.6972 6.07944L22.9193 6.34472L22.907 7.59088L22.8885 8.83087L21.4077 8.86172C20.0318 8.89256 19.9084 8.9049 19.6739 9.02828C19.3531 9.20102 18.9891 9.61435 18.9089 9.9043C18.8718 10.0462 18.8472 12.4028 18.8472 16.2708V22.4214L19.0199 22.7484C19.2112 23.1186 19.5937 23.4455 19.9454 23.5442C20.0688 23.5751 20.7599 23.6059 21.4756 23.6059C22.4011 23.6059 22.7898 23.6244 22.8453 23.6799C22.8947 23.7293 22.9193 24.0871 22.9193 24.8768V25.9995L22.6972 26.2648C22.3887 26.635 22.2962 26.8447 22.2591 27.2395C22.2345 27.5356 22.253 27.6344 22.4072 27.9243C22.7096 28.498 23.2648 28.7695 23.9065 28.6523C24.4803 28.5474 24.9431 28.0292 25.0048 27.4308C25.0418 27.0421 24.9492 26.783 24.6161 26.3512L24.3384 25.9995V24.8397C24.3384 23.8403 24.3508 23.6738 24.4371 23.6429C24.4927 23.6244 25.486 23.6059 26.6521 23.6059C28.6389 23.6059 28.7808 23.6121 28.8363 23.717C28.8672 23.7787 28.8918 24.3215 28.8857 24.9508L28.8733 26.0674L28.6512 26.3018C28.318 26.6473 28.2008 26.9126 28.2008 27.3074C28.207 28.0477 28.8116 28.6646 29.5273 28.6646C30.2924 28.6646 30.8786 28.1587 30.9773 27.4123C31.0205 27.0915 30.8786 26.7275 30.5454 26.2833L30.3233 25.9934V24.8768C30.3233 24.0871 30.3479 23.7293 30.3973 23.6799C30.4528 23.6244 30.8662 23.6059 31.8596 23.6059C33.1306 23.6059 33.2787 23.5936 33.5316 23.4764C33.871 23.3221 34.1178 23.0939 34.2905 22.7731C34.4139 22.5448 34.4263 22.4091 34.4571 21.1383L34.488 19.7564L34.7348 19.707C35.0618 19.6392 36.6906 19.6885 36.8449 19.7687C36.9128 19.8057 37.0053 19.8798 37.0485 19.9353C37.32 20.2623 38.0727 20.3918 38.5293 20.1944C39.3869 19.8242 39.5967 18.72 38.9488 18.0105C38.7452 17.7946 38.3195 17.6219 37.9678 17.6219C37.5853 17.6219 37.3076 17.7453 36.9745 18.0599L36.7277 18.3005H35.6294C34.6854 18.3005 34.525 18.2881 34.4941 18.2018C34.4756 18.1462 34.4571 17.1962 34.4571 16.0858C34.4571 14.599 34.4756 14.0499 34.5312 13.9944C34.5805 13.9451 34.9322 13.9204 35.7035 13.9204H36.7955L36.9991 14.0993C37.4619 14.5003 38.0172 14.599 38.5355 14.3707C39.0722 14.1301 39.3684 13.6181 39.319 13.0197C39.2203 11.8599 37.7334 11.4034 36.9313 12.2917L36.74 12.5015H35.6356C34.6854 12.5015 34.525 12.4892 34.4941 12.4028C34.4756 12.3473 34.4571 11.8044 34.4571 11.1875C34.4571 10.1387 34.4448 10.0462 34.309 9.75624C34.2288 9.5835 34.0746 9.36142 33.9574 9.26888C33.544 8.91724 33.4391 8.89873 31.8349 8.86172L30.3541 8.83087L30.3356 7.59088L30.3233 6.35088L30.5269 6.07944C30.8971 5.59825 30.9526 5.43168 30.9279 4.969C30.8971 4.45079 30.6811 4.09915 30.2616 3.8894C29.6446 3.58095 29.0584 3.65498 28.5957 4.10532C28.0157 4.66671 28.0157 5.34532 28.6018 6.03626L28.8425 6.32621L28.8301 7.57854L28.8116 8.83087H26.6213H24.431L24.4125 7.58471L24.4001 6.33854L24.6716 5.96223C24.8629 5.7093 24.9616 5.49954 24.9924 5.3083C25.1282 4.40761 24.2582 3.57478 23.3512 3.74134ZM25.7205 12.193C25.8069 12.2239 25.9179 12.3349 25.9735 12.4336C26.0228 12.5385 26.43 13.6304 26.8743 14.8581C27.3185 16.0919 27.8676 17.5972 28.1021 18.2079C28.7006 19.8119 28.6882 19.7687 28.5587 19.9106C28.4661 20.0093 28.3674 20.0278 27.8553 20.0278C27.0779 20.0278 27.0162 19.9785 26.7447 19.2135C26.6336 18.8989 26.5102 18.6028 26.4794 18.5596C26.4362 18.5041 26.066 18.4855 24.8752 18.4979L23.3265 18.5164L23.0859 19.195C22.9563 19.5651 22.8206 19.9044 22.7836 19.9476C22.6849 20.071 21.42 20.0587 21.2905 19.9353C21.1732 19.8119 21.1856 19.7626 22.1172 17.1962C22.5121 16.0919 23.0612 14.5743 23.3265 13.8279C23.6721 12.8593 23.8572 12.4213 23.9744 12.2979C24.141 12.1375 24.1595 12.1314 24.8567 12.1314C25.2454 12.1314 25.6341 12.156 25.7205 12.193ZM31.2364 16.0426C31.2426 18.5472 31.2302 19.8859 31.1871 19.9291C31.1007 20.0155 29.8173 19.9785 29.7556 19.8859C29.6939 19.7934 29.6878 12.2917 29.7495 12.2301C29.7741 12.2115 30.1135 12.1992 30.5022 12.2054L31.2179 12.2239L31.2364 16.0426Z'
                    fill='white'
                  />
                  <path
                    d='M24.8319 14.1857C24.8319 14.1919 24.6283 14.8026 24.3754 15.5306C24.0299 16.5238 23.9311 16.8816 23.9867 16.9371C24.0299 16.9803 24.363 17.005 24.9368 17.005C25.6711 17.005 25.8315 16.9865 25.8562 16.9125C25.9117 16.7706 25.017 14.1672 24.9122 14.1672C24.869 14.1672 24.8319 14.1734 24.8319 14.1857Z'
                    fill='white'
                  />
                </svg>
              </div>
              <div className='flex flex-col gap-0.5 leading-none'>
                <span className='font-semibold'>AI Guro</span>
                <span className=''>{selectedTenant.name}</span>
              </div>
              <ChevronsUpDown className='ml-auto' />
            </SidebarMenuButton>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            className='w-[--radix-dropdown-menu-trigger-width]'
            align='start'
          >
            {tenants.map((tenant) => (
              <DropdownMenuItem
                key={tenant.id}
                onSelect={() => handleTenantSwitch(tenant)}
              >
                {tenant.name}{' '}
                {tenant.id === selectedTenant.id && (
                  <Check className='ml-auto' />
                )}
              </DropdownMenuItem>
            ))}
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    </SidebarMenu>
  );
}
